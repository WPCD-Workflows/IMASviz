

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>3.1.2. Developing a simple plugin for plotting data from IDSs &mdash; IMASViz 2019 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="3.1.3. Developing a custom user interface (UI) plugins with Qt designer" href="plugin_QTdesigner.html" />
    <link rel="prev" title="3.1.1. IMASViz and plugins" href="plugin_introduction.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> IMASViz
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../intro/index.html">1. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../manual/index.html">2. User Manual</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">3. HOWTOs</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="index.html">3.1. Plugins</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="plugin_introduction.html">3.1.1. IMASViz and plugins</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">3.1.2. Developing a simple plugin for plotting data from IDSs</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#adding-imasviz-sources-to-pythonpath">3.1.2.1. Adding IMASViz sources to $PYTHONPATH</a></li>
<li class="toctree-l4"><a class="reference internal" href="#setting-plugin-source-structure">3.1.2.2. Setting plugin source structure</a></li>
<li class="toctree-l4"><a class="reference internal" href="#python-code">3.1.2.3. Python code</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="plugin_QTdesigner.html">3.1.3. Developing a custom user interface (UI) plugins with Qt designer</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">IMASViz</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">3. HOWTOs</a> &raquo;</li>
        
          <li><a href="index.html">3.1. Plugins</a> &raquo;</li>
        
      <li>3.1.2. Developing a simple plugin for plotting data from IDSs</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/howto/plugins/plugin_getting_started.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="developing-a-simple-plugin-for-plotting-data-from-idss">
<span id="plugin-simple-plot-example"></span><h1>3.1.2. Developing a simple plugin for plotting data from IDSs<a class="headerlink" href="#developing-a-simple-plugin-for-plotting-data-from-idss" title="Permalink to this headline">¶</a></h1>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Before proceeding with the plugin development instructions make sure that
you have <strong>cloned IMASViz GIT repository</strong> (for more information see section
<a class="reference internal" href="../../manual/getting_started.html#running-from-source"><span class="std std-ref">Running IMASViz from source</span></a>)!</p>
</div>
<p>This section will cover step by step instructions on how to:</p>
<blockquote>
<div><ul class="simple">
<li><p>write a very simple introductory plugin example (~80 lines of code),</p></li>
<li><p>how to register the plugin in IMASViz, and</p></li>
<li><p>how to run the plugin in IMASViz.</p></li>
</ul>
</div></blockquote>
<p>This simple plugin can be considered also as a starting template for more
complex plugins with advanced design and functionalities.</p>
<p>The main basic steps which will be covered in this tutorial are as follows:</p>
<ol class="arabic simple">
<li><p>Adding IMASViz home directory to <span class="target" id="index-0"></span><code class="xref std std-envvar docutils literal notranslate"><span class="pre">$PYTHONPATH</span></code></p></li>
<li><p>Setting plugin source structure</p></li>
<li><p>Writing the code:</p>
<ol class="loweralpha simple">
<li><p>Import statements</p></li>
<li><p>Class (prescribed name)</p></li>
<li><p>Class inheritance</p></li>
<li><p>Mandatory method functions</p></li>
</ol>
</li>
<li><p>Registering plugin in IMASViz</p></li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Complete code of the simple plugin (named as <strong>simplePlotPluginExample</strong>) is
available in IMASViz code source in
<code class="file docutils literal notranslate"><span class="pre">$VIZ_HOME/imasviz/VizPlugins/viz_simple_plot_example</span></code>.</p>
</div>
<div class="section" id="adding-imasviz-sources-to-pythonpath">
<h2>3.1.2.1. Adding IMASViz sources to $PYTHONPATH<a class="headerlink" href="#adding-imasviz-sources-to-pythonpath" title="Permalink to this headline">¶</a></h2>
<p>In order to have IMASViz sources at our disposal the <code class="docutils literal notranslate"><span class="pre">$VIZ_HOME</span></code> must be added
to <span class="target" id="index-1"></span><code class="xref std std-envvar docutils literal notranslate"><span class="pre">$PYTHONPATH</span></code> environment variable. This can be achieved by running
the next command in the terminal:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># bash
export PYTHONPATH=${VIZ_HOME}:${PYTHONPATH}
# tcsh
setenv PYTHONPATH ${VIZ_HOME}:${PYTHONPATH}
</pre></div>
</div>
</div>
<div class="section" id="setting-plugin-source-structure">
<span id="plugin-simple-plot-example-setting-dir"></span><h2>3.1.2.2. Setting plugin source structure<a class="headerlink" href="#setting-plugin-source-structure" title="Permalink to this headline">¶</a></h2>
<p>All plugin source files must be stored in a separate directory under
<code class="file docutils literal notranslate"><span class="pre">$VIZ_HOME/imasviz/VizPlugins/&lt;folder_name&gt;</span></code>. The name of the directory
should start with “<strong>viz_</strong>”.</p>
<p>For the purposes of this tutorial create a new directory with label
<strong>viz_my_example</strong> to distinguish it from other plugins. The full path is then
<code class="file docutils literal notranslate"><span class="pre">$VIZ_HOME/imasviz/VizPlugins/viz_my_plugin</span></code>.</p>
<p>Inside the newly created directory create a new Python script file. In this case
name it as <code class="file docutils literal notranslate"><span class="pre">myPlugin.py</span></code>. The script can be left empty for now.</p>
</div>
<div class="section" id="python-code">
<h2>3.1.2.3. Python code<a class="headerlink" href="#python-code" title="Permalink to this headline">¶</a></h2>
<p>This subsection will cover the contents of the plugin main Python script file
<code class="file docutils literal notranslate"><span class="pre">$VIZ_HOME/imasviz/VizPlugins/viz_my_plugin/myPlugin.py</span></code> (previously
created in <a class="reference internal" href="#plugin-simple-plot-example-setting-dir"><span class="std std-ref">Setting plugin source structure</span></a>).</p>
<div class="section" id="required-import-statements">
<h3>3.1.2.3.1. Required import statements<a class="headerlink" href="#required-import-statements" title="Permalink to this headline">¶</a></h3>
<p>As the first entry in the Python script, the next modules need to be imported
with the use of the import statements.</p>
<p>In your <code class="file docutils literal notranslate"><span class="pre">myPlugin.py</span></code> file add:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># modules for event logging system and for operating system dependent</span>
<span class="c1"># functionality</span>
<span class="kn">import</span> <span class="nn">logging</span><span class="o">,</span> <span class="nn">os</span>
<span class="c1"># IMASViz plugin sources</span>
<span class="kn">from</span> <span class="nn">imasviz.VizPlugins.VizPlugin</span> <span class="kn">import</span> <span class="n">VizPlugin</span>
<span class="c1"># Matplotlib library</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
</pre></div>
</div>
</div>
<div class="section" id="prescribed-class-name">
<h3>3.1.2.3.2. Prescribed class name<a class="headerlink" href="#prescribed-class-name" title="Permalink to this headline">¶</a></h3>
<p>The plugins main Python file must contain a class with the same name as the
name of the Python file. In this case, a class <strong>myPlugin</strong>.</p>
<p>In your <code class="file docutils literal notranslate"><span class="pre">myPlugin.py</span></code> file add:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">myPlugin</span><span class="p">():</span>
</pre></div>
</div>
</div>
<div class="section" id="inheritance">
<h3>3.1.2.3.3. Inheritance<a class="headerlink" href="#inheritance" title="Permalink to this headline">¶</a></h3>
<p>The class must inherit from <strong>VizPlugin class</strong> from the <code class="file docutils literal notranslate"><span class="pre">VizPlugin.py</span></code>.
This is required for IMASViz to be able to gather necessary information
required for properly running the plugin.</p>
<p>In your <code class="file docutils literal notranslate"><span class="pre">myPlugin.py</span></code> file add:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">myPlugin</span><span class="p">(</span><span class="n">VizPlugin</span><span class="p">):</span>
</pre></div>
</div>
</div>
<div class="section" id="mandatory-method-functions">
<h3>3.1.2.3.4. Mandatory method functions<a class="headerlink" href="#mandatory-method-functions" title="Permalink to this headline">¶</a></h3>
<p>The plugin class must contain 5 mandatory method functions (besides constructor):</p>
<ul class="simple">
<li><p><strong>execute(self, vizAPI, pluginEntry)</strong></p></li>
<li><p><strong>getEntries(self)</strong></p></li>
<li><p><strong>getPluginsConfiguration(self)</strong></p></li>
<li><p><strong>getAllEntries(self)</strong></p></li>
<li><p><strong>isEnabled(self)</strong></p></li>
</ul>
<div class="section" id="constructor">
<h4>3.1.2.3.4.1. Constructor<a class="headerlink" href="#constructor" title="Permalink to this headline">¶</a></h4>
<p>In this case, leave the constructor empty.</p>
<p>In your <code class="file docutils literal notranslate"><span class="pre">myPlugin.py</span></code> file add:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>
</div>
</div>
<div class="section" id="execute">
<h4>3.1.2.3.4.2. execute()<a class="headerlink" href="#execute" title="Permalink to this headline">¶</a></h4>
<p>The <span class="guilabel">execute()</span> function consists of three parts:</p>
<ol class="arabic simple">
<li><p>Obtaining data source from IMASViz</p></li>
<li><p>Checking if the IDS data was already fetched</p></li>
<li><p>Extracting and plotting the data from the IDS</p></li>
</ol>
<p><strong>1. Obtaining data source (IDS object) from IMASViz:</strong></p>
<p>This is done through <strong>vizAPI</strong> - <strong>the IMASViz Application Program Interface
(API)</strong> and its <strong>GetDataSource</strong> function.</p>
<p>In your <code class="file docutils literal notranslate"><span class="pre">myPlugin.py</span></code> file add:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get dataSource from the VizAPI (IMASViz Application Program Interface)</span>
<span class="c1"># Note: instance of &quot;self.datatreeView&quot; is provided by the VizPlugins</span>
<span class="c1"># through inheritance</span>
<span class="n">dataSource</span> <span class="o">=</span> <span class="n">vizAPI</span><span class="o">.</span><span class="n">GetDataSource</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataTreeView</span><span class="p">)</span>
<span class="c1"># Get case parameters (shot, run, machine user) from the dataSource</span>
<span class="n">shot</span> <span class="o">=</span> <span class="n">dataSource</span><span class="o">.</span><span class="n">shotNumber</span>
<span class="n">run</span> <span class="o">=</span> <span class="n">dataSource</span><span class="o">.</span><span class="n">runNumber</span>
<span class="n">machine</span> <span class="o">=</span> <span class="n">dataSource</span><span class="o">.</span><span class="n">imasDbName</span>
<span class="n">user</span> <span class="o">=</span> <span class="n">dataSource</span><span class="o">.</span><span class="n">userName</span>
<span class="n">occurrence</span> <span class="o">=</span> <span class="mi">0</span>

<span class="c1"># Displaying basic case information</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;Reading data...&#39;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;Shot    =&#39;</span><span class="p">,</span> <span class="n">shot</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;Run     =&#39;</span><span class="p">,</span> <span class="n">run</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;User    =&#39;</span><span class="p">,</span> <span class="n">user</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;Machine =&#39;</span><span class="p">,</span> <span class="n">machine</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>2. Checking if the IDS data was already fetched</strong></p>
<p>With the use of functions provided by <strong>vizAPI</strong> we can be check if the
case (IDS) data was already fetched (loaded in memory) while running IMASViz.
In case the data was not yet fetched it can be done with the use of the
<strong>LoadIDSData</strong> function (with the use of this function also the IMASViz data
tree view browser gets updated automatically).</p>
<p>The IDS object is then obtained with the use of <strong>getImasEntry()</strong> function
for given occurrence (default occurrence value is 0).</p>
<p>In your <code class="file docutils literal notranslate"><span class="pre">myPlugin.py</span></code> file add:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check if the IDS data is already loaded in IMASviz. If it is not,</span>
<span class="c1"># load it</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">vizAPI</span><span class="o">.</span><span class="n">IDSDataAlreadyFetched</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataTreeView</span><span class="p">,</span> <span class="s1">&#39;magnetics&#39;</span><span class="p">,</span> <span class="n">occurrence</span><span class="p">):</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Loading magnetics IDS...&#39;</span><span class="p">)</span>
    <span class="n">vizAPI</span><span class="o">.</span><span class="n">LoadIDSData</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataTreeView</span><span class="p">,</span> <span class="s1">&#39;magnetics&#39;</span><span class="p">,</span> <span class="n">occurrence</span><span class="p">)</span>

<span class="c1"># Get IDS object</span>
<span class="bp">self</span><span class="o">.</span><span class="n">ids</span> <span class="o">=</span> <span class="n">dataSource</span><span class="o">.</span><span class="n">getImasEntry</span><span class="p">(</span><span class="n">occurrence</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>3. Extracting and plotting the data from the IDS</strong></p>
<p>With the IDS object available its contents can be easily accessed (following the
structure defined by the <span class="guilabel">Data Dictionary</span>). The data can be then
plotted with the use of the <span class="guilabel">Matplotlib</span> Python library
(<a class="reference external" href="https://matplotlib.org/">link</a>).</p>
<p>This plugin example will read some simple data from the <strong>Magnetics IDS</strong>
and plot it using <strong>Matplotlib</strong> plitting utilities:</p>
<ul class="simple">
<li><p><strong>time values</strong> (stored in <code class="docutils literal notranslate"><span class="pre">magnetics.time</span></code> node) -&gt; <strong>X axis</strong></p></li>
<li><p><strong>poloidal field probe values</strong> (stored in <code class="docutils literal notranslate"><span class="pre">magnetics.bpol_probe</span></code> array of
structures (AOS). The values are stored in
<code class="docutils literal notranslate"><span class="pre">magnetics.bpol_probe[i].field.data</span></code> where <span class="math notranslate nohighlight">\(i\)</span> is the array index)
-&gt; <strong>Y axis</strong></p></li>
</ul>
<p>In your <code class="file docutils literal notranslate"><span class="pre">myPlugin.py</span></code> file add:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get some data from the IDS and pass it to plot (using matplotlib)</span>
<span class="c1"># - Set subplot</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="c1"># - Extract X-axis values (time)</span>
<span class="n">time_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">magnetics</span><span class="o">.</span><span class="n">time</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">time_values</span>
<span class="c1"># - Get the size of AoS (number of arrays)</span>
<span class="n">num_bpol_probe_AoS</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">magnetics</span><span class="o">.</span><span class="n">bpol_probe</span><span class="p">)</span>
<span class="c1"># - For each array extract array values and create a plot</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_bpol_probe_AoS</span><span class="p">):</span>
    <span class="c1"># - Extract array values</span>
    <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">magnetics</span><span class="o">.</span><span class="n">bpol_probe</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">field</span><span class="o">.</span><span class="n">data</span>
    <span class="c1"># - Set plot (line) defined by X and Y values +</span>
    <span class="c1"># - set line as full line (-) and add legend label.</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;bpol_probe[&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;]&#39;</span><span class="p">)</span>
<span class="c1"># - Enable grid</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="c1"># - Set axis labels and plot title</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;time [s]&#39;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Poloidal field probe values&#39;</span><span class="p">,</span>
       <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Poloidal field probe&#39;</span><span class="p">)</span>
<span class="c1"># - Enable legend</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="c1"># - Draw/Show plots</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="getentries">
<h4>3.1.2.3.4.3. getEntries()<a class="headerlink" href="#getentries" title="Permalink to this headline">¶</a></h4>
<p>The <span class="guilabel">getEntries()</span> method function provides IMASViz the information to
which IDS the plugin is associated. While in the IMASViz tree view browser,
the plugin will be then accessible by right-clicking on here defined IDS
(the option for running this plugin gets shown in the popup menu).</p>
<p>In this case, as the plugin deals with the data stored in <strong>Magnetics IDS</strong>,
this option should be set to <code class="docutils literal notranslate"><span class="pre">&quot;magnetics&quot;</span></code> as shown in the code part below.</p>
<p>In your <code class="file docutils literal notranslate"><span class="pre">myPlugin.py</span></code> file add:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">getEntries</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectedTreeNode</span><span class="o">.</span><span class="n">getIDSName</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;magnetics&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="getpluginsconfiguration">
<h4>3.1.2.3.4.4. getPluginsConfiguration()<a class="headerlink" href="#getpluginsconfiguration" title="Permalink to this headline">¶</a></h4>
<p>The <span class="guilabel">getPluginsConfiguration()</span> method function provides additional
configurations to IMASViz. In this case no additional configurations are
required -&gt; the function returns value <strong>None</strong>.</p>
<p>In your <code class="file docutils literal notranslate"><span class="pre">myPlugin.py</span></code> file add:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">getPluginsConfiguration</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">None</span>
</pre></div>
</div>
</div>
<div class="section" id="getallentries">
<h4>3.1.2.3.4.5. getAllEntries()<a class="headerlink" href="#getallentries" title="Permalink to this headline">¶</a></h4>
<p>The <span class="guilabel">getAllEntries()</span> method function provides IMASViz ‘cosmetic’
information (e.g. label which should be shown in the popup menu etc.).</p>
<p>In your <code class="file docutils literal notranslate"><span class="pre">myPlugin.py</span></code> file add:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">getAllEntries</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="c1"># Set a text which will be displayed in the pop-up menu</span>
    <span class="k">return</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;My plugin...&#39;</span><span class="p">)]</span>
</pre></div>
</div>
</div>
<div class="section" id="isenabled">
<h4>3.1.2.3.4.6. isEnabled()<a class="headerlink" href="#isenabled" title="Permalink to this headline">¶</a></h4>
<p>Through the <span class="guilabel">isEnabled()</span> method function the custom plugin can be
either <strong>enabled</strong> (returns <code class="docutils literal notranslate"><span class="pre">True</span></code>) or <strong>disabled</strong> (returns <code class="docutils literal notranslate"><span class="pre">False</span></code>).</p>
<p>In your <code class="file docutils literal notranslate"><span class="pre">myPlugin.py</span></code> file add:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">isEnabled</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">True</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="full-python-code">
<h3>3.1.2.3.5. Full Python code<a class="headerlink" href="#full-python-code" title="Permalink to this headline">¶</a></h3>
<p>Below is a full code in <code class="file docutils literal notranslate"><span class="pre">myPlugin.py</span></code> which is done by following the
steps in the previous subsections.</p>
<div class="literal-block-wrapper docutils container" id="id1">
<div class="code-block-caption"><span class="caption-text">myPlugin.py</span><a class="headerlink" href="#id1" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># modules for event logging system and for operating system dependent</span>
<span class="c1"># functionality</span>
<span class="kn">import</span> <span class="nn">logging</span><span class="o">,</span> <span class="nn">os</span>
<span class="c1"># IMASViz plugin sources</span>
<span class="kn">from</span> <span class="nn">imasviz.VizPlugins.VizPlugin</span> <span class="kn">import</span> <span class="n">VizPlugin</span>
<span class="c1"># Matplotlib library</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>

<span class="k">class</span> <span class="nc">myPlugin</span><span class="p">(</span><span class="n">VizPlugin</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vizAPI</span><span class="p">,</span> <span class="n">pluginEntry</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Main plugin function.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Get dataSource from the VizAPI (IMASViz Application Program Interface)</span>
        <span class="c1"># Note: instance of &quot;self.datatreeView&quot; is provided by the VizPlugins</span>
        <span class="c1"># through inheritance</span>
        <span class="n">dataSource</span> <span class="o">=</span> <span class="n">vizAPI</span><span class="o">.</span><span class="n">GetDataSource</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataTreeView</span><span class="p">)</span>
        <span class="c1"># Get case parameters (shot, run, machine user) from the dataSource</span>
        <span class="n">shot</span> <span class="o">=</span> <span class="n">dataSource</span><span class="o">.</span><span class="n">shotNumber</span>
        <span class="n">run</span> <span class="o">=</span> <span class="n">dataSource</span><span class="o">.</span><span class="n">runNumber</span>
        <span class="n">machine</span> <span class="o">=</span> <span class="n">dataSource</span><span class="o">.</span><span class="n">imasDbName</span>
        <span class="n">user</span> <span class="o">=</span> <span class="n">dataSource</span><span class="o">.</span><span class="n">userName</span>
        <span class="n">occurrence</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># Check if the IDS data is already loaded in IMASviz. If it is not,</span>
        <span class="c1"># load it</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">vizAPI</span><span class="o">.</span><span class="n">IDSDataAlreadyFetched</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataTreeView</span><span class="p">,</span> <span class="s1">&#39;magnetics&#39;</span><span class="p">,</span> <span class="n">occurrence</span><span class="p">):</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Loading magnetics IDS...&#39;</span><span class="p">)</span>
            <span class="n">vizAPI</span><span class="o">.</span><span class="n">LoadIDSData</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataTreeView</span><span class="p">,</span> <span class="s1">&#39;magnetics&#39;</span><span class="p">,</span> <span class="n">occurrence</span><span class="p">)</span>

        <span class="c1"># Get IDS</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ids</span> <span class="o">=</span> <span class="n">dataSource</span><span class="o">.</span><span class="n">getImasEntry</span><span class="p">(</span><span class="n">occurrence</span><span class="p">)</span>

        <span class="c1"># Displaying basic information</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Reading data...&#39;</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Shot    =&#39;</span><span class="p">,</span> <span class="n">shot</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Run     =&#39;</span><span class="p">,</span> <span class="n">run</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;User    =&#39;</span><span class="p">,</span> <span class="n">user</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Machine =&#39;</span><span class="p">,</span> <span class="n">machine</span><span class="p">)</span>

        <span class="c1"># Get some data from the IDS and pass it to plot (using matplotlib)</span>
        <span class="c1"># - Set subplot</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
        <span class="c1"># - Extract X-axis values (time)</span>
        <span class="n">time_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">magnetics</span><span class="o">.</span><span class="n">time</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">time_values</span>
        <span class="c1"># - Get the size of AoS (number of arrays)</span>
        <span class="n">num_bpol_probe_AoS</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">magnetics</span><span class="o">.</span><span class="n">bpol_probe</span><span class="p">)</span>
        <span class="c1"># - For each array extract array values and create a plot</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_bpol_probe_AoS</span><span class="p">):</span>
            <span class="c1"># - Extract array values</span>
            <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ids</span><span class="o">.</span><span class="n">magnetics</span><span class="o">.</span><span class="n">bpol_probe</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">field</span><span class="o">.</span><span class="n">data</span>
            <span class="c1"># - Set plot (line) defined by X and Y values +</span>
            <span class="c1"># - set line as full line (-) and add legend label.</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;bpol_probe[&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;]&#39;</span><span class="p">)</span>
        <span class="c1"># - Enable grid</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
        <span class="c1"># - Set axis labels and plot title</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;time [s]&#39;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Poloidal field probe values&#39;</span><span class="p">,</span>
               <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Poloidal field probe&#39;</span><span class="p">)</span>
        <span class="c1"># - Enable legend</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        <span class="c1"># - Draw/Show plots</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">getEntries</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectedTreeNode</span><span class="o">.</span><span class="n">getIDSName</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;magnetics&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">getPluginsConfiguration</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">getAllEntries</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Set a text which will be displayed in the pop-up menu</span>
        <span class="k">return</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;Magnetics overview (simple plot plugin example)...&#39;</span><span class="p">)]</span>

    <span class="k">def</span> <span class="nf">isEnabled</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">True</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
<div class="section" id="registering-plugin-in-imasviz">
<h3>3.1.2.3.6. Registering plugin in IMASViz<a class="headerlink" href="#registering-plugin-in-imasviz" title="Permalink to this headline">¶</a></h3>
<p>In order to register the plugin in IMASViz, a single entry is required in the
top part of the <code class="file docutils literal notranslate"><span class="pre">$VIZ_HOME/imasviz/VizPlugins/VizPlugin.py</span></code> file.</p>
<p>In the <span class="guilabel">RegisteredPlugins</span> dictionary add key and corresponding value
relevant for your plugin, e.g. <kbd class="kbd docutils literal notranslate">'myPlugin' : 'viz_my_plugin.myPlugin'</kbd>.</p>
<p>Here the key must match the <strong>py. file</strong> and <strong>class name</strong> while the
corresponding value must match <kbd class="kbd docutils literal notranslate">'&lt;plugin_source_path&gt;.&lt;py_file_name.py&gt;'</kbd>.</p>
<p>In this case, it should look something like this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">RegisteredPlugins</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;equilibriumcharts&#39;</span><span class="p">:</span><span class="s1">&#39;viz_equi.equilibriumcharts&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;ToFuPlugin&#39;</span><span class="p">:</span><span class="s1">&#39;viz_tofu.viz_tofu_plugin&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;SOLPS_UiPlugin&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;CompareFLT1DPlugin&#39;</span><span class="p">:</span><span class="s1">&#39;viz_tests.CompareFLT1DPlugin&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;viz_example_plugin&#39;</span><span class="p">:</span><span class="s1">&#39;viz_example_plugin.viz_example_plugin&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;example_UiPlugin&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;simplePlotPluginExample&#39;</span> <span class="p">:</span> <span class="s1">&#39;viz_simple_plot_example.simplePlotPluginExample&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;ETSpluginIMASViz&#39;</span> <span class="p">:</span> <span class="s1">&#39;viz_ETS.ETSpluginIMASViz&#39;</span><span class="p">,</span>
<span class="hll">                     <span class="s1">&#39;myPlugin&#39;</span> <span class="p">:</span> <span class="s1">&#39;viz_my_plugin.myPlugin&#39;</span>
</span>                     <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="executing-the-custom-plugin-in-imasviz">
<h3>3.1.2.3.7. Executing the custom plugin in IMASViz<a class="headerlink" href="#executing-the-custom-plugin-in-imasviz" title="Permalink to this headline">¶</a></h3>
<p>To run the plugin in IMASViz while in IMASViz session with opened IDS database,
in <span class="guilabel">tree view browser</span>:</p>
<ul>
<li><p>on the IDS previously specified in <span class="guilabel">getEntries()</span>
method function (<strong>Magnetics IDS</strong>) either:</p>
<ul class="simple">
<li><p>hold shift key + right-click on the tree node. A popup menu including the
menu action (with label previously specified in
<span class="guilabel">getAllEntries()</span>) will be shown, or</p></li>
</ul>
<blockquote>
<div><div class="figure align-center" id="id2">
<a class="reference internal image-reference" href="../../_images/IMASViz_simple_plot_example_plugin_menu_1.png"><img alt="../../_images/IMASViz_simple_plot_example_plugin_menu_1.png" src="../../_images/IMASViz_simple_plot_example_plugin_menu_1.png" style="width: 473.40000000000003px; height: 82.8px;" /></a>
<p class="caption"><span class="caption-text">Popup menu on shift + right-click on <strong>Magnetics IDS</strong> showing the
available action for executing the plugin.</span><a class="headerlink" href="#id2" title="Permalink to this image">¶</a></p>
</div>
</div></blockquote>
<ul class="simple">
<li><p>just right-click on the tree node. A popup menu including the
<span class="guilabel">Plugin</span> selection will be shown. Hovering on this selection will
shown the menu action (with label previously specified in
<span class="guilabel">getAllEntries()</span>).</p></li>
</ul>
<blockquote>
<div><div class="figure align-center" id="id3">
<a class="reference internal image-reference" href="../../_images/IMASViz_simple_plot_example_plugin_menu_2.png"><img alt="../../_images/IMASViz_simple_plot_example_plugin_menu_2.png" src="../../_images/IMASViz_simple_plot_example_plugin_menu_2.png" style="width: 680.8000000000001px; height: 91.2px;" /></a>
<p class="caption"><span class="caption-text">Popup menu on right-click on <strong>Magnetics IDS</strong> showing the
available action for executing the plugin.</span><a class="headerlink" href="#id3" title="Permalink to this image">¶</a></p>
</div>
</div></blockquote>
</li>
<li><p>click on the menu action. The plugin will be executed and the results (plot)
will be shown in a matplotlib plot window.</p>
<blockquote>
<div><div class="figure align-center" id="id4">
<a class="reference internal image-reference" href="../../_images/IMASViz_simple_plot_example_plugin_result.png"><img alt="../../_images/IMASViz_simple_plot_example_plugin_result.png" src="../../_images/IMASViz_simple_plot_example_plugin_result.png" style="width: 567.2px; height: 588.8000000000001px;" /></a>
<p class="caption"><span class="caption-text">The result of the simple plot plugin execution: plotted poloidal field
probe values (all available signals).</span><a class="headerlink" href="#id4" title="Permalink to this image">¶</a></p>
</div>
</div></blockquote>
</li>
</ul>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="plugin_QTdesigner.html" class="btn btn-neutral float-right" title="3.1.3. Developing a custom user interface (UI) plugins with Qt designer" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="plugin_introduction.html" class="btn btn-neutral float-left" title="3.1.1. IMASViz and plugins" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Dejan Penko, Fleury Ludovic

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>